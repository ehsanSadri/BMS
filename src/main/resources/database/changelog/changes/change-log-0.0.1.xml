<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">
    <changeSet id="init-create-user" author="ehsan" failOnError="true">
        <sql>
            create sequence USERS_SEQ
                increment by 1;

            create sequence ACCOUNT_SEQ
                increment by 1;

            create sequence TRANSACTION_SEQ
                increment by 1;

            CREATE TABLE USERS
            (
                id            long primary key,
                name          NVARCHAR(250),
                lastname      NVARCHAR(250),
                national_code NVARCHAR(10),
                birth_date    TIMESTAMP,
                role          NVARCHAR(250)
            );


            CREATE TABLE ACCOUNT
            (
                id         long primary key,
                title      NVARCHAR(250),
                created    TIMESTAMP,
                user_id_fk long references USERS (id)
            );


            alter table USERS
                add column account_id_fk long references ACCOUNT (id);

            create type transaction_mode as enum ('INCREASE', 'DECREASE');

            CREATE TABLE TRANSACTION
            (
                id               long primary key,
                title            NVARCHAR(250),
                amount           numeric,
                transaction_mode transaction_mode,
                account_id_fk    long references ACCOUNT (id)
            );
        </sql>
    </changeSet>

    <changeSet id="add-account-number" author="ehsan" failOnError="true">
        <sql>
            alter table ACCOUNT
                add column account_number varchar(5) unique;
        </sql>
    </changeSet>

    <changeSet id="admin-deposit-service" author="ehsan" failOnError="false">
        <sql>
            alter table ACCOUNT
                add column locked boolean not null default false;

            update ACCOUNT
            set locked = false
            where true
        </sql>
    </changeSet>
</databaseChangeLog>

